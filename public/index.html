<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">System Stats & OpenClaw Monitor</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header with Agent Name -->
    <div class="dashboard-header">
        <div class="header-left">
            <h1>System Stats & OpenClaw Monitor</h1>
        </div>
        <div class="header-right">
            <div class="agent-badge" id="agent-badge">
                <span class="agent-label">Agent:</span>
                <span class="agent-name" id="agent-name">Loading...</span>
            </div>
            <div class="api-status-header" id="api-status">
                <div class="status-dot"></div>
                <span>API Inactive</span>
                <button class="api-setup-btn" id="api-setup-btn">Configure</button>
            </div>
            <div class="connection-status-header" id="connection-status">
                <div class="status-dot"></div>
                <span>Gateway Active</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Top Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" id="cpu-value">--</div>
                <div class="stat-label">CPU Load Avg<br>Last avg (4 cores)</div>
            </div>
            <div class="stat-card memory">
                <div class="stat-value" id="memory-value">--</div>
                <div class="stat-label">Memory<br>used vs total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="disk-value">--</div>
                <div class="stat-label">Disk Usage<br>used vs total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uptime-value">--</div>
                <div class="stat-label">System Uptime<br>since boot</div>
            </div>
            <div class="stat-card openclaw">
                <div class="status-indicator" id="openclaw-indicator"></div>
                <div class="stat-label">OpenClaw Active<br>74 processes + 4k TUI 3.4k CPU</div>
                <div class="service-detail">Gateway Running...</div>
            </div>
            <div class="stat-card model-indicator">
                <div class="stat-value" id="model-value">Haiku</div>
                <div class="stat-label">Current Model<br>claude-3-haiku-20240307</div>
                <div class="model-badge" id="model-badge">haiku</div>
            </div>
            <div class="stat-card token-session">
                <div class="stat-value" id="session-tokens">---</div>
                <div class="stat-label">This Session<br>Token Usage</div>
                <div class="token-cost" id="session-cost">$0.00</div>
            </div>
            <div class="stat-card token-alltime">
                <div class="stat-value" id="alltime-tokens">---</div>
                <div class="stat-label">All-Time<br>Token Usage</div>
                <div class="token-cost" id="alltime-cost">$0.00</div>
            </div>
            <div class="stat-card backup-indicator">
                <div class="stat-value" id="backup-size">275MB</div>
                <div class="stat-label">Backup Size<br>Last 72 hours</div>
                <div class="backup-time" id="backup-time">Just now</div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- File Tree -->
                <div class="panel file-tree-panel">
                    <div class="panel-header">
                        <h3>File Tree <span id="file-tree-path">(~/loading...)</span></h3>
                    </div>
                    <div class="panel-content" id="file-tree">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Work Queue -->
                <div class="panel work-queue-panel">
                    <div class="panel-header">
                        <h3>Work Queue & Current Tasks</h3>
                    </div>
                    <div class="task-input-form">
                        <input type="text" id="task-title" placeholder="Task name" maxlength="50">
                        <input type="text" id="task-detail" placeholder="Details" maxlength="100">
                        <select id="task-status">
                            <option value="ACTIVE">Active</option>
                            <option value="STUCK">Stuck</option>
                            <option value="ERROR">Error</option>
                            <option value="COMPLETE">Complete</option>
                        </select>
                        <button id="add-task-btn">Add</button>
                    </div>
                    <div class="task-tabs">
                        <button class="tab-btn active" data-tab="ACTIVE">ACTIVE</button>
                        <button class="tab-btn" data-tab="STUCK">STUCK</button>
                        <button class="tab-btn" data-tab="ERROR">ERROR</button>
                        <button class="tab-btn" data-tab="COMPLETE">COMPLETE</button>
                    </div>
                    <div class="panel-content" id="work-queue">
                        <div class="loading">Loading...</div>
                    </div>
                </div>

                <!-- Git Log -->
                <div class="panel git-log-panel">
                    <div class="panel-header">
                        <h3>Git Log (Last 20)</h3>
                    </div>
                    <div class="panel-content" id="git-log">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Panel -->
        <div class="bottom-panel">
            <div class="panel logs-panel">
                <div class="panel-header">
                    <h3>Live Logs</h3>
                </div>
                <div class="panel-content" id="live-logs">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- API Key Modal -->
    <div class="modal" id="api-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Anthropic API</h2>
                <button class="modal-close" id="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    Add your Anthropic API key to enable real-time token usage monitoring and cost tracking in the dashboard.
                </p>
                <div class="form-group">
                    <label for="api-key-input">API Key</label>
                    <input 
                        type="password" 
                        id="api-key-input" 
                        placeholder="sk-ant-..." 
                        class="api-key-input"
                    >
                    <p class="help-text">
                        Your API key is stored securely on the backend and never exposed on the frontend.
                    </p>
                </div>
                <div class="form-group">
                    <label for="api-endpoint-input">Custom Endpoint (Optional)</label>
                    <input 
                        type="text" 
                        id="api-endpoint-input" 
                        placeholder="https://api.anthropic.com/v1/usage" 
                        class="api-endpoint-input"
                    >
                    <p class="help-text">
                        Leave blank to use Anthropic's default API endpoint.
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btn-cancel">Cancel</button>
                <button class="btn-save" id="btn-save-api">Add API Key</button>
            </div>
        </div>
    </div>

    <script src="js/dashboard.js"></script>
</body>
</html>